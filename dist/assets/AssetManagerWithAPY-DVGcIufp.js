import{j as e,u as a}from"./index-BkZZq67j.js";import{r as s}from"./ui-CjFzYUMr.js";import{u as n,a as t}from"./useMutation-BChOhwjn.js";import{C as r,f as i,p as o,a as c}from"./ethers-BDgFcnCu.js";import"./vendor-CtPCxZU4.js";const d=({asset:a,userBalance:s,stakeBalance:n,onStake:t,onUnstake:r,onStakeZHype:i,onUnstakeZHype:o,formatBalance:c,error:d,isStaking:l,isUnstaking:u,pendingRewards:y,onClaimRewards:m,isClaiming:p,isConnected:w})=>e.jsxs("div",{className:"asset-card",children:[e.jsxs("div",{className:"asset-card-header",children:[e.jsx("h3",{children:a.symbol}),e.jsxs("div",{className:"asset-balance",children:[c(s,a.decimals)," ",a.symbol]})]}),e.jsxs("div",{className:"asset-card-content",children:[e.jsxs("div",{className:"asset-info",children:[e.jsxs("div",{className:"info-row",children:[e.jsx("span",{children:"APY:"}),e.jsxs("span",{children:[a.apy,"%"]})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{children:"Staked:"}),e.jsx("span",{children:c(n,a.decimals)})]})]}),e.jsxs("div",{className:"asset-actions",children:[e.jsx("button",{className:"btn btn-primary",onClick:()=>t(a),disabled:!w||l,children:l?"Staking...":"Stake"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>r(a),disabled:!w||u,children:u?"Unstaking...":"Unstake"})]}),y&&"0.000"!==y.zHype&&e.jsxs("div",{className:"rewards-section",children:[e.jsxs("div",{className:"rewards-info",children:[e.jsx("span",{children:"Pending Rewards:"}),e.jsxs("span",{children:[y.zHype," zHYPE"]})]}),e.jsx("button",{className:"btn btn-success",onClick:m,disabled:!w||p,children:p?"Claiming...":"Claim Rewards"})]})]})]}),l=["function balanceOf(address owner) external view returns (uint256)","function totalSupply() external view returns (uint256)","function allowance(address owner, address spender) external view returns (uint256)","function approve(address spender, uint256 amount) external returns (bool)","function transfer(address to, uint256 amount) external returns (bool)","function decimals() external view returns (uint8)","function symbol() external view returns (string)","function name() external view returns (string)"],u=({account:u,provider:y,signer:m,contractAddresses:p,treasuryContract:w,isConnected:g,onConnect:f})=>{const v=a(),[h,k]=s.useState([]),x=[{address:"native",symbol:"HYPE",name:"Hyperliquid Native",decimals:18,color:"#FF6B35",isNative:!0,apy:contractAPYs?.hypeAPY||500}],S={address:p?.zHypeToken||"0x0000000000000000000000000000000000000000",symbol:"zHYPE",name:"zHYPE Token",decimals:18,color:"#8B5CF6",isNative:!1,isZHypeStaking:!0,apy:contractAPYs?.zhypeAPY||17},{data:b,refetch:j}=n({queryKey:["userBalances",u],queryFn:async()=>{const e={};for(const n of x)try{let s,t="0";if(n.isNative){s=await y.getBalance(u);try{const e=await w.getZHypeTokenAddress(),a=new r(e,l,y);t=await a.balanceOf(u)}catch(a){}}e[n.address]={balance:s.toString(),depositBalance:t.toString(),decimals:n.decimals}}catch(s){e[n.address]={balance:"0",depositBalance:"0",decimals:n.decimals,error:s.message}}return e},enabled:!!u&&!!y,refetchInterval:1e4}),{data:H,error:B}=n({queryKey:["zHypeTokenBalance",u,p.treasury],queryFn:async()=>{if(!p.treasury||"0x0000000000000000000000000000000000000000"===p.treasury)throw new Error("Treasury contract not available");const e=new r(p.treasury,["function getZHypeTokenAddress() external view returns (address)"],y),a=await e.getZHypeTokenAddress(),s=new r(a,l,y);return(await s.balanceOf(u)).toString()},enabled:!!u&&!!y&&!!p.treasury&&"0x0000000000000000000000000000000000000000"!==p.treasury,refetchInterval:1e4}),[P,E]=s.useState("0");s.useEffect(()=>{(async()=>{if(u&&y&&p.treasury&&"0x0000000000000000000000000000000000000000"!==p.treasury)try{const e=new r(p.treasury,["function getZHypeTokenAddress() external view returns (address)"],y),a=await e.getZHypeTokenAddress(),s=new r(a,l,y),n=await s.balanceOf(u),t=i(n);E(t)}catch(e){}})()},[u,y,p.treasury]);const{data:N,refetch:A}=n({queryKey:["apyInfo",p.treasury],queryFn:async()=>{if(!w)return null;const[e,a,s]=await Promise.all([w.getAPYPercentage(),w.getTotalDeposits(),w.getTotalRewardsDistributed()]);return{apy:e.toString(),totalDeposits:a.toString(),totalRewards:s.toString()}},enabled:!!w,refetchInterval:3e4}),{data:C,refetch:T}=n({queryKey:["pendingRewards",u,p.treasury],queryFn:async()=>{if(!w||!u)return"0";return(await w.getPendingRewards(u)).toString()},enabled:!!w&&!!u,refetchInterval:1e4}),z=t({mutationFn:async({asset:e,amount:a})=>{if(!e.isNative)throw new Error("Only native HYPE staking supported");{const e=await w.deposit({value:a,gasLimit:2e5});await e.wait()}},onSuccess:()=>{v.invalidateQueries(["userBalances"]),v.invalidateQueries(["zHypeTokenBalance"]),v.invalidateQueries(["pendingRewards"]),v.invalidateQueries(["apyInfo"]),setShowStakeModal(!1)},onError:e=>{}}),F=t({mutationFn:async({asset:e,amount:a})=>{if(!e.isNative)throw new Error("Only native HYPE unstaking supported");{const e=o(a.toString()),s=await w.requestUnstake(e,{gasLimit:2e5});await s.wait()}},onSuccess:()=>{v.invalidateQueries(["userBalances"]),v.invalidateQueries(["zHypeTokenBalance"]),v.invalidateQueries(["pendingRewards"]),v.invalidateQueries(["apyInfo"]),setShowUnstakeModal(!1)},onError:e=>{}}),Q=t({mutationFn:async()=>{if(!w)throw new Error("Treasury contract not initialized");const e=await w.claimRewards({gasLimit:15e4});await e.wait()},onSuccess:()=>{v.invalidateQueries(["userBalances"]),v.invalidateQueries(["zHypeTokenBalance"]),v.invalidateQueries(["pendingRewards"]),v.invalidateQueries(["apyInfo"])},onError:e=>{}}),R=t({mutationFn:async({amount:e})=>{if(!w)throw new Error("Treasury contract not initialized");throw new Error("zHYPE staking not yet implemented")},onSuccess:()=>{v.invalidateQueries(["userBalances"]),v.invalidateQueries(["zHypeTokenBalance"])},onError:e=>{}}),Y=t({mutationFn:async({amount:e})=>{if(!w)throw new Error("Treasury contract not initialized");throw new Error("zHYPE unstaking not yet implemented")},onSuccess:()=>{v.invalidateQueries(["userBalances"]),v.invalidateQueries(["zHypeTokenBalance"])},onError:e=>{}}),U=async e=>{if(g)try{await R.mutateAsync({amount:e})}catch(a){}else f()},Z=async e=>{if(g)try{await Y.mutateAsync({amount:e})}catch(a){}else f()},q=async()=>{if(g)try{await Q.mutateAsync()}catch(e){}else f()},I=async e=>{if(g){if(e&&!(parseFloat(e)<=0))try{const a=supportedAssets[0];await z.mutateAsync({asset:a,amount:o(e.toString())})}catch(a){}}else f()},O=async e=>{if(g){if(e&&!(parseFloat(e)<=0))try{const a=supportedAssets[0];await F.mutateAsync({asset:a,amount:parseFloat(e)})}catch(a){}}else f()},K=(e,a)=>{if(!e)return"0";const s=c(e,a);return parseFloat(s).toFixed(6).replace(/\.?0+$/,"")};return s.useEffect(()=>{const e=JSON.parse(localStorage.getItem("unstakingQueue")||"[]");k(e)},[]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"asset-manager-content",children:[e.jsx("div",{className:"asset-card-main",children:x.map(a=>e.jsx(d,{asset:a,userBalance:b?.[a.address]?.balance||"0",stakeBalance:H||P||"0",onStake:I,onUnstake:O,onStakeZHype:U,onUnstakeZHype:Z,formatBalance:K,error:b?.[a.address]?.error,isStaking:z.isPending,isUnstaking:F.isPending,pendingRewards:C,onClaimRewards:q,isClaiming:Q.isPending,isConnected:g},a.address))}),e.jsxs("div",{className:"asset-card-main",children:[e.jsx(d,{asset:S,userBalance:H||P||"0",stakeBalance:"0",onStake:I,onUnstake:O,onStakeZHype:U,onUnstakeZHype:Z,formatBalance:K,error:null,isStaking:z.isPending,isUnstaking:F.isPending,pendingRewards:C,onClaimRewards:q,isClaiming:Q.isPending,isConnected:g},S.address),e.jsx("div",{})]})]})})};export{u as default};
